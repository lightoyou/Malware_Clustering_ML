#!/usr/bin/env python
#-*- coding: utf-8 -*-
import os
import lief
from lief import to_json
import json
import pprint
import hashlib
import numpy as np


pp = pprint.PrettyPrinter(indent=4)

AllFile = []
AllPE = []
DictHashes = {}
PathDataset = "dataset/"


#data_directories
for root, subFolders, files in os.walk(PathDataset):
    for file in files:
        PathDataset = os.path.join(root, file)
        AllFile.append(PathDataset)
        hasher_md5 = hashlib.md5()
        hasher_sha256 = hashlib.sha256()
        with open(PathDataset, 'rb') as afile:
                 buf = afile.read()
                 hasher_md5.update(buf)
                 hasher_sha256.update(buf)
                 print(hasher_md5.hexdigest())
                 print(hasher_sha256.hexdigest())


for p in AllFile:
    try:
        print("\n")
        print(p)
        pe = lief.parse(p)
        pe_json = to_json(pe)
        pp.pprint(json.loads(pe_json))
        AllPE.append(pe)
    except:
        pass


#for p in AllPE:
#    json_data = json.loads(to_json(p))
#    with open('file.json','w') as f:
#        f.write(json.dumps(json_data, indent=4))
