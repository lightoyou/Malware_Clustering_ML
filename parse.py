#!/usr/bin/env python
#-*- coding: utf-8 -*-
import os
import lief
from lief import to_json
import json
import pprint
import hashlib
import numpy as np


pp = pprint.PrettyPrinter(indent=4)

AllFile = []
AllPE = []

PathDataset = "dataset/"


#data_directories
for root, subFolders, files in os.walk(PathDataset):
    for file in files:
        PathDataset = os.path.join(root, file)
        AllFile.append(PathDataset)



for p in AllFile:
    try:
        pe = lief.parse(p)
        print("######### DOS HEADER #########")
        pp.pprint(to_json(pe.dos_header))
        print("######### HEADER #########")
        pp.pprint(to_json(pe.header))
        print("######### OPTIONAL HEADER #########")
        pp.pprint(to_json(pe.optional_header))
        print("######### SECTIONS #########")
        pp.pprint(to_json(pe.sections))
        print("######### IMPORTED FUNCTIONS #########")
        pp.pprint(to_json(pe.imported_functions))
        AllPE.append(pe)
    except:
        pass

#for p in AllPE:
#    json_data = json.loads(to_json(p))
#    with open('file.json','w') as f:
#        f.write(json.dumps(json_data, indent=4))
